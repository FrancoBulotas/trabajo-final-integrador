<ion-header>
  <ion-toolbar color="light">
    <ion-title>Iniciar sesión</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="form" (ngSubmit)="login()">

    <!-- Correo -->
    <ion-item>
      <ion-label position="floating">Correo</ion-label>
      <ion-input formControlName="email" type="email" [clearInput]="true"></ion-input>
    </ion-item>
    @if (showError('email','required')) {
      <ion-text color="danger">
        <p class="ion-padding-start">El correo es obligatorio</p>
      </ion-text>
    }
    @if (showError('email','email')) {
      <ion-text color="danger">
        <p class="ion-padding-start">Correo inválido</p>
      </ion-text>
    }

    <!-- Contraseña -->
    <ion-item>
      <ion-label position="floating">Contraseña</ion-label>
      <ion-input
        formControlName="password"
        [type]="showPassword ? 'text' : 'password'">
      </ion-input>

      <ion-buttons slot="end">
        <ion-button fill="clear" size="small" (click)="showPassword = !showPassword">
          <ion-icon slot="icon-only" [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
    @if (showError('password','required')) {
      <ion-text color="danger">
        <p class="ion-padding-start">La contraseña es obligatoria</p>
      </ion-text>
    }
    @if (showError('password','minlength')) {
      <ion-text color="danger">
        <p class="ion-padding-start">Mínimo 6 caracteres</p>
      </ion-text>
    }

    <ion-button
      class="ion-margin-top"
      expand="block"
      type="submit"
      [disabled]="loading || form.invalid">
      @if (loading) {
        <ion-spinner name="crescent" class="ion-margin-end"></ion-spinner>
      }
      {{ loading ? 'Ingresando...' : 'Ingresar' }}
    </ion-button>

    <ion-button expand="block" fill="clear" routerLink="/register">
      Crear cuenta
    </ion-button>

    <!-- Accesos rápidos -->
    <ion-card class="ion-margin-top">
      <ion-card-header>
        <ion-card-subtitle>Usuarios de prueba</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-grid class="test-grid">
          <ion-row>
            <ion-col size="12" sizeMd="4">
              <ion-button
                expand="block"
                class="test-btn test-1"
                (click)="quickLogin('francobulotas@gmail.com','prueba1234!')">
                <div class="btn-content">
                  <div class="title">Prueba 1</div>
                  <div class="subtitle">francobulotas@gmail.com</div>
                </div>
              </ion-button>
            </ion-col>

            <ion-col size="12" sizeMd="4">
              <ion-button
                expand="block"
                class="test-btn test-2"
                (click)="quickLogin('prueba1@gmail.com','prueba1234')">
                <div class="btn-content">
                  <div class="title">Prueba 2</div>
                  <div class="subtitle">prueba1@gmail.com</div>
                </div>
              </ion-button>
            </ion-col>

            <ion-col size="12" sizeMd="4">
              <ion-button
                expand="block"
                class="test-btn test-3"
                (click)="quickLogin('prueba@gmail.com','prueba1234')">
                <div class="btn-content">
                  <div class="title">Prueba 3</div>
                  <div class="subtitle">prueba@gmail.com</div>
                </div>
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Toast de mensajes -->
    <ion-toast
      [isOpen]="showToast"
      [message]="toastMessage"
      [color]="toastColor"
      duration="3000"
      (didDismiss)="showToast = false">
    </ion-toast>
  </form>
</ion-content>
